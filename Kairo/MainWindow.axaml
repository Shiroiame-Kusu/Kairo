<Window xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:fa="using:FluentAvalonia.UI.Controls"
    xmlns:controls="clr-namespace:Kairo.Controls"
    xmlns:vm="clr-namespace:Kairo.ViewModels"
        mc:Ignorable="d"
        x:Class="Kairo.MainWindow"
    x:DataType="vm:MainWindowViewModel"
        Title="Kairo - Another LocyanFrp Client"
        Width="800" Height="500"
        MinWidth="800" MinHeight="450"
        WindowStartupLocation="CenterScreen"
        Icon="avares://Kairo/Assets/kairo.ico"
        SystemDecorations="None"
        TransparencyLevelHint="Mica, AcrylicBlur, Blur"
        Background="Transparent">
    <Window.KeyBindings>
        <KeyBinding Command="{Binding StartOAuthCommand}" Gesture="Enter" />
    </Window.KeyBindings>
    <Window.Styles>
        <!-- Style for fade transitions on controls -->
        <Style Selector="Control.fade">
            <Setter Property="Transitions">
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.3" Easing="CircularEaseOut" />
                </Transitions>
            </Setter>
        </Style>
    </Window.Styles>
    <Border CornerRadius="12" Background="{DynamicResource SolidBackgroundFillColorBaseBrush}"
            BorderBrush="{DynamicResource ControlStrokeColorDefaultBrush}" BorderThickness="0" ClipToBounds="True">
        <Grid RowDefinitions="Auto,*">
            <!-- Custom Title Bar -->
            <controls:CustomTitleBar Title="Kairo - Another LocyanFrp Client" />
            <Grid Grid.Row="1" ColumnDefinitions="*,300,*">
                <Grid Grid.Column="1" Margin="0">
                    <Grid VerticalAlignment="Center" RowDefinitions="0,120,20,*">
                        <!-- Banner region -->
                        <Grid Grid.Row="1">
                            <Border CornerRadius="8" Background="Transparent">
                                <Image x:Name="Banner" Source="avares://Kairo/Assets/banner.png" Stretch="Uniform" />
                            </Border>
                        </Grid>
                        <!-- Login Status -->
                        <Grid Grid.Row="3">
                            <StackPanel x:Name="LoginStatusPanel" Orientation="Horizontal" HorizontalAlignment="Center"
                                        VerticalAlignment="Center" Classes="fade"
                                        Opacity="{Binding LoginStatusOpacity}"
                                        IsVisible="{Binding IsLoginStatusVisible}">
                                <fa:ProgressRing Width="28" Height="28" IsActive="True" />
                                <TextBlock Margin="15,0" FontSize="16" VerticalAlignment="Center" Text="正在登录" />
                            </StackPanel>
                        </Grid>
                        <!-- Login Form -->
                        <Border x:Name="LoginForm" Grid.Row="3" Margin="12" Padding="0" CornerRadius="8"
                                Background="{DynamicResource LayerFillColorAltBrush}" Classes="fade"
                                Opacity="{Binding LoginFormOpacity}"
                                IsVisible="{Binding IsLoginFormVisible}">
                            <Grid RowDefinitions="220,*">
                                <Grid>
                                    <Grid RowDefinitions="*,*">
                                        <TextBlock Margin="0,10" HorizontalAlignment="Center"
                                                   VerticalAlignment="Bottom" Text="使用OAuth进行登录" FontSize="16" />
                                        <Button x:Name="LoginButton" Grid.Row="1" Margin="50,16,50,0" Content="登录"
                                                Height="36" HorizontalAlignment="Stretch"
                                                Command="{Binding StartOAuthCommand}"
                                                IsEnabled="{Binding IsLoginEnabled}" />
                                    </Grid>
                                </Grid>
                                <!-- <Grid Grid.Row="1" ColumnDefinitions="*,*" Margin="0,8,0,0"> -->
                                <!--   <HyperlinkButton HorizontalAlignment="Center" VerticalAlignment="Center" Content="没有账号? 前往注册" Tag="https://dashboard.locyanfrp.cn/auth/register" Click="HyperlinkButton_Click" /> -->
                                <!--   <HyperlinkButton Grid.Column="1" HorizontalAlignment="Center" VerticalAlignment="Center" Content="忘记密码?" Tag="https://dashboard.locyanfrp.cn/reset_password" Click="HyperlinkButton_Click" /> -->
                                <!-- </Grid> -->
                            </Grid>
                        </Border>
                    </Grid>
                    <TextBlock x:Name="Tips" Text="{Binding TipText}" HorizontalAlignment="Center" VerticalAlignment="Bottom"
                               Foreground="Gray" FontSize="11" Margin="0,4" />
                    <fa:InfoBar x:Name="Snackbar" IsOpen="{Binding IsSnackbarOpen}" Title="{Binding SnackbarTitle}"
                                Message="{Binding SnackbarMessage}" Severity="{Binding SnackbarSeverity}"
                                Margin="0,8,0,0" HorizontalAlignment="Stretch" VerticalAlignment="Top" />
                </Grid>
            </Grid>
        </Grid>
    </Border>
</Window>